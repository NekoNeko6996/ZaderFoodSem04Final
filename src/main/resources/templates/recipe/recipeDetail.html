<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
      lang="en">
    <head>
    <div th:replace="~{fragments/head :: common-head}"></div>
    <title th:text="${recipe.name + ' - Smart Meal Planner'}">Recipe Detail</title>
</head>
<body class="bg-background-light font-display text-dark-ink">
    <div class="relative flex min-h-screen w-full flex-col group/design-root">
        <div th:replace="~{fragments/navbar :: header_nav}"></div>

        <main class="flex flex-1 justify-center px-4 py-8 sm:px-8 sm:py-12">
            <div class="w-full max-w-5xl">
                <div class="bg-card-white rounded-xl shadow-soft overflow-hidden border border-border-color">

                    <div class="w-full bg-center bg-no-repeat bg-cover flex flex-col justify-end min-h-[320px] md:min-h-[400px]"
                         th:style="|background-image: url('${recipe.imageUrl != null ? recipe.imageUrl : 'https://via.placeholder.com/800x400'}');|">
                    </div>

                    <div class="p-6 md:p-10">
                        <div class="flex flex-col gap-4 md:gap-6">
                            <div class="flex flex-wrap justify-between gap-4">
                                <div class="flex min-w-72 flex-col gap-2">
                                    <h1 class="text-dark-ink text-4xl font-black leading-tight tracking-[-0.033em]"
                                        th:text="${recipe.name}">Recipe Name</h1>

                                    <p class="text-soft-grey text-base font-normal leading-normal">
                                        <span th:text="${recipe.totalCalories != null ? recipe.totalCalories : 0} + ' Calories'"></span> |
                                        <span th:text="${recipe.cookTimeMin != null ? recipe.cookTimeMin : 0} + ' min Cook Time'"></span> |
                                        <span th:text="'Serves ' + ${recipe.servings != null ? recipe.servings : 1}"></span>
                                        <span th:if="${recipe.difficulty != null}" th:text="' | ' + ${recipe.difficulty}"></span>
                                    </p>
                                    <p class="text-dark-ink/80 text-sm mt-1" th:text="${recipe.description}"></p>
                                </div>

                                <div class="flex flex-wrap gap-3 items-start">
                                    <button class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-chef-orange text-white text-base font-bold w-full sm:w-auto hover:bg-opacity-90 transition">
                                        Add to Meal Plan
                                    </button>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-5 gap-8 md:gap-12 pt-6">
                                <div class="md:col-span-2">
                                    <h2 class="text-dark-ink text-[22px] font-bold leading-tight tracking-[-0.015em] pb-4">Ingredients</h2>
                                    <div class="flex flex-col gap-4">
                                        <label th:each="ri : ${recipe.recipeIngredients}" class="flex items-center gap-3 text-base text-dark-ink cursor-pointer group hover:bg-gray-50 p-2 rounded transition">
                                            <input class="h-5 w-5 rounded border-gray-300 text-chef-orange focus:ring-chef-orange/50" type="checkbox"/>
                                            <div class="flex flex-wrap gap-1">
                                                <span class="font-bold text-chef-orange" th:text="${ri.quantity}"></span>
                                                <span class="font-medium text-chef-orange" th:text="${ri.unit}"></span>
                                                <span class="text-dark-ink" th:text="${ri.ingredient != null ? ri.ingredient.name : 'Unknown'}"></span>
                                            </div>
                                        </label>
                                        <p th:if="${#lists.isEmpty(recipe.recipeIngredients)}" class="text-soft-grey italic">No ingredients listed.</p>
                                    </div>
                                </div>

                                <div class="md:col-span-3">
                                    <h2 class="text-dark-ink text-[22px] font-bold leading-tight tracking-[-0.015em] pb-4">Instructions</h2>
                                    <div class="prose prose-base text-dark-ink max-w-none">
                                        <ol class="list-decimal pl-5 space-y-4">
                                            <li th:each="step : ${recipe.recipeSteps}" class="pl-2">
                                                <span th:text="${step.instruction}"></span>
                                                <div th:if="${step.mediaUrl != null}" class="mt-2">
                                                    <img th:src="${step.mediaUrl}" class="rounded-lg h-40 object-cover" alt="Step image">
                                                </div>
                                            </li>
                                        </ol>
                                        <p th:if="${#lists.isEmpty(recipe.recipeSteps)}" class="text-soft-grey italic">No instructions available.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-border-color pt-8 mt-8">
                                <h2 class="text-dark-ink text-[22px] font-bold leading-tight pb-4">Ask AI about Nutrition</h2>
                                <div class="relative mt-2">
                                    <input type="hidden" id="recipeId" th:value="${recipe.recipeId}" />
                                    <input id="aiQuestionInput" class="w-full h-12 px-4 pr-12 text-dark-ink bg-white border border-border-color rounded-lg focus:ring-2 focus:ring-chef-orange/50 focus:border-chef-orange placeholder:text-soft-grey" placeholder="Example: How much protein is in this dish?" type="text"/>
                                    <button onclick="handleAskAI()" class="absolute inset-y-0 right-0 flex items-center justify-center w-12 text-chef-orange hover:text-dark-ink">
                                        <span class="material-symbols-outlined">send</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function handleAskAI() {
            const question = document.getElementById('aiQuestionInput').value;
            alert("AI Feature: " + question + " (Coming Soon)");
        }
    </script>
</body>
</html>