<!DOCTYPE html>
<html class="light" lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8"/>
        <title>Register Step 3</title>
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
        <script>
            tailwind.config = {
                theme: {extend: {colors: {"nutri-green": "#4CAF50", "chef-orange": "#FF7043", "dark-ink": "#263238", "soft-grey": "#78909C", "smart-mist": "#ECEFF1", "card-white": "#FFFFFF", "smart-white": "#FAFAFA", "error": "#E53935"}, fontFamily: {"display": ["Plus Jakarta Sans", "sans-serif"]}}}
            }
        </script>
        <style> .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            } </style>
    </head>
    <body class="font-display">
        <div th:replace="~{fragments/navbar_auth :: header_nav}"></div>

        <div class="relative flex h-auto min-h-screen w-full flex-col items-center justify-center bg-smart-white p-4">
            <div class="w-full max-w-md">
                <form th:action="@{/register/step3}" th:object="${user}" method="POST" class="flex flex-col items-center rounded-xl border border-smart-mist bg-card-white p-6 shadow-lg sm:p-8">

                    <div class="w-full mb-6 flex gap-2">
                        <div class="h-1 flex-1 bg-nutri-green rounded"></div>
                        <div class="h-1 flex-1 bg-nutri-green rounded"></div>
                        <div class="h-1 flex-1 bg-nutri-green rounded"></div>
                    </div>

                    <h1 class="text-dark-ink text-[32px] font-bold pb-2">Account Details</h1>
                    <p class="text-soft-grey pb-6">Create your username and password.</p>

                    <div th:if="${message}" class="w-full mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg text-sm text-center">
                        <span th:text="${message}"></span>
                    </div>

                    <div th:if="${error}" class="w-full mb-4 p-3 bg-red-100 text-error rounded-lg text-sm text-center" th:text="${error}"></div>

                    <div class="w-full mb-4 p-3 bg-green-50 rounded-lg border border-green-200 flex items-center gap-2">
                        <span class="material-symbols-outlined text-nutri-green text-sm">check_circle</span>
                        <span class="text-sm text-dark-ink" th:text="${session.regEmail}">email@example.com</span>
                    </div>

                    <div class="flex w-full flex-col gap-4">
                        <label class="flex flex-col">
                            <p class="text-dark-ink text-sm font-medium pb-2">Username</p>
                            <input th:field="*{username}" required class="form-input w-full rounded-lg border border-smart-mist h-12 p-4 outline-none focus:ring-2 focus:ring-nutri-green/50" placeholder="Choose a username" />
                        </label>

                        <div class="flex flex-col gap-2">
                            <label class="flex flex-col relative">
                                <p class="text-dark-ink text-sm font-medium pb-2">Password</p>
                                <input th:field="*{password}" type="password" required id="passwordInput"
                                       class="form-input w-full rounded-lg border border-smart-mist h-12 p-4 pr-10 outline-none focus:ring-2 focus:ring-nutri-green/50" 
                                       placeholder="Create password" />
                            </label>

                            <div class="flex flex-col gap-1">
                                <div class="flex justify-between">
                                    <span class="text-xs font-medium text-soft-grey">Strength</span>
                                    <span id="strengthText" class="text-xs font-bold text-soft-grey">None</span>
                                </div>
                                <div class="w-full bg-smart-mist rounded-full h-1.5">
                                    <div id="strengthBar" class="h-1.5 rounded-full transition-all duration-300" style="width: 0%; background-color: transparent;"></div>
                                </div>
                            </div>
                        </div>

                        <label class="flex flex-col relative">
                            <p class="text-dark-ink text-sm font-medium pb-2">Confirm Password</p>
                            <input name="confirmPassword" type="password" required id="confirmPasswordInput"
                                   class="form-input w-full rounded-lg border border-smart-mist h-12 p-4 pr-10 outline-none focus:ring-2 focus:ring-nutri-green/50" 
                                   placeholder="Confirm password" />
                        </label>
                    </div>

                    <button type="submit" class="w-full h-12 mt-6 rounded-lg bg-nutri-green text-white font-bold hover:opacity-90 transition-colors">
                        Complete Registration
                    </button>
                </form>
            </div>
        </div>

        <script>
            // 1. Toggle Ẩn/Hiện mật khẩu
            function togglePassword(inputId) {
                const input = document.getElementById(inputId);
                input.type = input.type === "password" ? "text" : "password";
            }

            // 2. Kiểm tra độ mạnh mật khẩu
            const passwordInput = document.getElementById('passwordInput');
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');

            passwordInput.addEventListener('input', function () {
                const val = passwordInput.value;
                let strength = 0;

                if (val.length >= 8)
                    strength += 1; // Độ dài
                if (val.match(/[0-9]/))
                    strength += 1; // Có số
                if (val.match(/[a-z]/) && val.match(/[A-Z]/))
                    strength += 1; // Chữ hoa + thường
                if (val.match(/[^a-zA-Z0-9]/))
                    strength += 1; // Ký tự đặc biệt

                // Cập nhật UI
                if (val.length === 0) {
                    updateStrength(0, 'transparent', 'None');
                } else if (val.length < 6) {
                    updateStrength(20, '#E53935', 'Too Short'); // Đỏ đậm
                } else {
                    switch (strength) {
                        case 1:
                            updateStrength(25, '#E53935', 'Weak');
                            break; // Đỏ
                        case 2:
                            updateStrength(50, '#FB8C00', 'Medium');
                            break; // Cam
                        case 3:
                            updateStrength(75, '#FDD835', 'Good');
                            break; // Vàng
                        case 4:
                            updateStrength(100, '#4CAF50', 'Strong');
                            break; // Xanh
                    }
                }
            });

            function updateStrength(width, color, text) {
                strengthBar.style.width = width + '%';
                strengthBar.style.backgroundColor = color;
                strengthText.innerText = text;
                strengthText.style.color = color === 'transparent' ? '#78909C' : color;
            }
        </script>
    </body>
</html>