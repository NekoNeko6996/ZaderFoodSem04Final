<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Chi tiết công thức</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    </head>
    <body class="bg-gray-100 font-sans">
        <div class="container mx-auto px-4 py-8 max-w-5xl">

            <!-- Navigation & Actions -->
            <div class="flex justify-between items-center mb-6">
                <a th:href="@{/admin/recipes/pending}" class="text-gray-600 hover:text-gray-900 font-medium">
                    <i class="fas fa-arrow-left mr-2"></i>Quay lại danh sách
                </a>
                <div class="flex space-x-3">
                    <!-- Nút Từ chối (Form POST) -->
                    <form th:action="@{/admin/recipes/{id}/reject(id=${recipe.recipeId})}" method="post" 
                          onsubmit="return confirm('Bạn có chắc muốn từ chối và XÓA công thức này không?');">
                        <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded shadow">
                            <i class="fas fa-times mr-1"></i> Từ chối
                        </button>
                    </form>

                    <!-- Nút Duyệt (Form POST) -->
                    <form th:action="@{/admin/recipes/{id}/approve(id=${recipe.recipeId})}" method="post"
                          onsubmit="return confirm('Xác nhận duyệt công thức này?');">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
                            <i class="fas fa-check mr-1"></i> Duyệt bài
                        </button>
                    </form>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Cột trái: Form Edit thông tin chính -->
                <div class="lg:col-span-2">
                    <form th:action="@{/admin/recipes/{id}/update(id=${recipe.recipeId})}" th:object="${recipe}" method="post">
                        <div class="bg-white rounded-lg shadow p-6 mb-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Thông tin cơ bản</h3>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700">Tên món ăn</label>
                                    <input type="text" th:field="*{name}" class="mt-1 block w-full border-gray-300 rounded border p-2 bg-gray-50 focus:bg-white transition">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700">Mô tả</label>
                                    <textarea th:field="*{description}" rows="3" class="mt-1 block w-full border-gray-300 rounded border p-2 bg-gray-50 focus:bg-white"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Calories (Total)</label>
                                    <input type="number" th:field="*{totalCalories}" class="mt-1 block w-full border p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Khẩu phần</label>
                                    <input type="number" th:field="*{servings}" class="mt-1 block w-full border p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Chuẩn bị (phút)</label>
                                    <input type="number" th:field="*{prepTimeMin}" class="mt-1 block w-full border p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Nấu (phút)</label>
                                    <input type="number" th:field="*{cookTimeMin}" class="mt-1 block w-full border p-2 rounded">
                                </div>
                            </div>
                            <div class="mt-4 text-right">
                                <button type="submit" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm">
                                    <i class="fas fa-save mr-1"></i> Lưu thay đổi thông tin
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- List các bước (Chỉ hiển thị, chưa làm form edit phức tạp) -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Các bước thực hiện</h3>
                        <div class="space-y-4">
                            <div th:each="step : ${recipe.recipeSteps}" class="flex items-start space-x-3">
                                <div class="flex-shrink-0 h-6 w-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-sm font-bold mt-1"
                                     th:text="${step.stepNumber}">1</div>
                                <p class="text-gray-700 text-sm bg-gray-50 p-2 rounded w-full" th:text="${step.instruction}"></p>
                            </div>
                            <div th:if="${#lists.isEmpty(recipe.recipeSteps)}" class="text-gray-400 italic text-sm">Chưa có hướng dẫn.</div>
                        </div>
                    </div>
                </div>

                <!-- Cột phải: Ảnh & Nguyên liệu -->
                <div class="space-y-6">
                    <!-- Ảnh -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-medium text-gray-800 mb-2">Hình ảnh</h3>
                        <div class="aspect-video bg-gray-100 rounded-lg overflow-hidden">
                            <img th:src="${recipe.imageUrl != null ? recipe.imageUrl : 'https://placehold.co/400x300'}" 
                                 class="object-cover w-full h-full">
                        </div>
                    </div>

                    <!-- Nguyên liệu -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Nguyên liệu</h3>
                        <div class="space-y-3">
                            <div th:each="ri : ${recipe.recipeIngredients}" class="flex justify-between items-center p-2 bg-gray-50 rounded border border-gray-100">
                                <div>
                                    <div class="font-medium text-gray-800 flex items-center">
                                        <span th:text="${ri.ingredient.name}">Tên nguyên liệu</span>
                                        <!-- Label 'Mới' nếu ingredient chưa active -->
                                        <span th:if="${!ri.ingredient.isActive}" 
                                              class="ml-2 text-[10px] bg-red-100 text-red-600 px-1 rounded border border-red-200 uppercase">MỚI</span>
                                    </div>
                                    <div class="text-xs text-gray-500" th:text="${ri.quantity + ' ' + ri.unit}"></div>
                                </div>
                            </div>
                            <div th:if="${#lists.isEmpty(recipe.recipeIngredients)}" class="text-gray-400 italic text-sm">Chưa có nguyên liệu.</div>
                        </div>

                        <div class="mt-4 bg-blue-50 p-3 rounded text-xs text-blue-800 border border-blue-200">
                            <i class="fas fa-info-circle mr-1"></i> Nguyên liệu <span class="font-bold text-red-500">MỚI</span> sẽ được kích hoạt khi bạn duyệt công thức này.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>