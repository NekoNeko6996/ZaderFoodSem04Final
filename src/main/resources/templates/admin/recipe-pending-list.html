<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" class="light" lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        <title>Pending Recipes - Zader Admin</title>

        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <style>
            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }
        </style>
        <script id="tailwind-config">
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {"primary": "#4bbe4f", "background-light": "#FAFAFA", "dark-ink": "#263238", "nutri-green": "#4CAF50", "alert-red": "#EF4444", "soft-grey": "#78909C"},
                        fontFamily: {"display": ["Manrope", "sans-serif"]},
                    },
                },
            }
        </script>
    </head>
    <body class="font-display bg-background-light text-dark-ink">
        <div class="relative flex min-h-screen w-full overflow-x-hidden group/design-root">

            <div th:replace="~{fragments/sidebar_nutritionist :: sidebar}"></div>

            <main class="flex-1 ml-64 bg-gray-50 min-h-screen">
                <div th:replace="~{fragments/navbar_admin :: header_nav_admin}"></div>
                <div class="p-8">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                        <div>
                            <h1 class="text-3xl font-extrabold text-dark-ink">Review Queue</h1>
                            <p class="text-soft-grey mt-1">Manage and approve community submitted recipes.</p>
                        </div>
                        <div class="flex items-center gap-3 bg-white px-5 py-3 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-orange-50 text-orange-600">
                                <span class="material-symbols-outlined">hourglass_top</span>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xs font-bold text-soft-grey uppercase">Pending</span>
                                <span class="text-xl font-black text-dark-ink" th:text="${recipes.size()}">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-100">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Recipe Info</th>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Author</th>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Difficulty</th>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Submitted</th>
                                        <th scope="col" class="relative px-6 py-4 text-right font-bold text-xs text-gray-500 uppercase tracking-wider">Action</th>
                                    </tr>
                                </thead>

                                <tbody id="tableBody" class="bg-white divide-y divide-gray-100">

                                    <tr th:each="recipe : ${recipes}" class="item-row group hover:bg-gray-50 transition-colors duration-200">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="h-12 w-12 flex-shrink-0 rounded-lg overflow-hidden border border-gray-200 bg-gray-100">
                                                    <img class="h-full w-full object-cover" th:src="${recipe.imageUrl != null ? recipe.imageUrl : 'https://placehold.co/100x100?text=No+Img'}" alt="">
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-bold text-dark-ink group-hover:text-nutri-green transition-colors" th:text="${recipe.name}">Name</div>
                                                    <div class="text-xs text-soft-grey flex items-center gap-1 mt-0.5">
                                                        <span class="material-symbols-outlined text-[14px]">restaurant</span>
                                                        <span th:text="${recipe.servings} + ' servings'">2 servings</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center gap-2">   
                                                <div class="h-6 w-6 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-xs font-bold">
                                                    <span class="material-symbols-outlined text-[14px]">person</span>
                                                </div>
                                                <span class="text-sm text-dark-ink font-medium" th:text="${recipe.user != null ? recipe.user.fullName : 'User #' + recipe.createdByUserId}">User</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2.5 py-1 inline-flex text-xs leading-4 font-bold rounded-md uppercase tracking-wide border"
                                                  th:classappend="${recipe.difficulty.name() == 'EASY' ? 'bg-green-50 text-green-700 border-green-100' : (recipe.difficulty.name() == 'MEDIUM' ? 'bg-yellow-50 text-yellow-700 border-yellow-100' : 'bg-red-50 text-red-700 border-red-100')}"
                                                  th:text="${recipe.difficulty}">EASY</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-soft-grey">
                                            <div class="flex flex-col">
                                                <span class="font-medium text-dark-ink" th:text="${#temporals.format(recipe.createdAt, 'dd MMM yyyy')}">Date</span>
                                                <span class="text-xs" th:text="${#temporals.format(recipe.createdAt, 'HH:mm')}">Time</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <a th:href="@{/nutritionist/recipes/{id}(id=${recipe.recipeId}, returnUrl='pending')}" 
                                               class="inline-flex items-center gap-1.5 bg-white border border-gray-300 hover:border-nutri-green hover:text-nutri-green text-dark-ink px-4 py-2 rounded-lg text-sm font-bold transition shadow-sm hover:shadow-md">
                                                Review <span class="material-symbols-outlined text-lg">arrow_forward</span>
                                            </a>
                                        </td>
                                    </tr>

                                    <tr th:if="${recipes.empty}">
                                        <td colspan="5" class="px-6 py-12 text-center">
                                            <div class="flex flex-col items-center justify-center">
                                                <div class="h-16 w-16 bg-green-50 rounded-full flex items-center justify-center mb-4">
                                                    <span class="material-symbols-outlined text-3xl text-nutri-green">check_circle</span>
                                                </div>
                                                <h3 class="text-lg font-bold text-dark-ink">All caught up!</h3>
                                                <p class="text-soft-grey text-sm mt-1">No pending recipes.</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div id="pagination-controls" class="px-6 py-4 border-t border-gray-100 flex items-center justify-between bg-white hidden">
                            <div class="text-sm text-gray-500">
                                Showing <span id="start-index" class="font-bold text-dark-ink">0</span> 
                                to <span id="end-index" class="font-bold text-dark-ink">0</span> 
                                of <span id="total-rows" class="font-bold text-dark-ink">0</span> entries
                            </div>

                            <div class="flex items-center gap-2">
                                <button onclick="prevPage()" id="btn-prev" class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 transition">
                                    <span class="material-symbols-outlined text-base">chevron_left</span> Prev
                                </button>

                                <div class="bg-nutri-green/10 text-nutri-green px-3 py-1.5 rounded-lg text-sm font-bold">
                                    Page <span id="current-page">1</span> / <span id="total-pages">1</span>
                                </div>

                                <button onclick="nextPage()" id="btn-next" class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 transition">
                                    Next <span class="material-symbols-outlined text-base">chevron_right</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </main>
        </div>

        <div th:replace="~{fragments/toast :: toast-system}"></div>
        <script>
            // --- JS PHÂN TRANG ---
            const rowsPerPage = 5; // Số dòng hiển thị
            let currentPage = 1;
            let rows = [];

            document.addEventListener("DOMContentLoaded", function () {
                initPagination();
            });

            function initPagination() {
                const tableBody = document.getElementById('tableBody');
                // Lấy tất cả dòng có class item-row (Bỏ qua dòng "All caught up")
                rows = Array.from(tableBody.querySelectorAll('tr.item-row'));

                const controlDiv = document.getElementById('pagination-controls');

                if (rows.length === 0) {
                    controlDiv.classList.add('hidden');
                    return;
                }

                controlDiv.classList.remove('hidden');

                document.getElementById('total-rows').innerText = rows.length;
                const totalPages = Math.ceil(rows.length / rowsPerPage);
                document.getElementById('total-pages').innerText = totalPages;

                showPage(1);
            }

            function showPage(page) {
                const totalPages = Math.ceil(rows.length / rowsPerPage);

                if (page < 1)
                    page = 1;
                if (page > totalPages && totalPages > 0)
                    page = totalPages;

                currentPage = page;

                const start = (currentPage - 1) * rowsPerPage;
                const end = start + rowsPerPage;

                // Logic ẩn hiện
                rows.forEach((row, index) => {
                    if (index >= start && index < end) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });

                // Cập nhật text UI
                document.getElementById('start-index').innerText = rows.length > 0 ? start + 1 : 0;
                document.getElementById('end-index').innerText = Math.min(end, rows.length);
                document.getElementById('current-page').innerText = currentPage;

                // Trạng thái nút bấm
                document.getElementById('btn-prev').disabled = (currentPage === 1);
                document.getElementById('btn-next').disabled = (currentPage === totalPages || totalPages === 0);
            }

            function prevPage() {
                if (currentPage > 1)
                    showPage(currentPage - 1);
            }

            function nextPage() {
                const totalPages = Math.ceil(rows.length / rowsPerPage);
                if (currentPage < totalPages)
                    showPage(currentPage + 1);
            }

            // --- CONFIRM ACTION (Code cũ) ---
            function confirmAction(formId, title = 'Are you sure?', text = "You won't be able to revert this!", confirmBtnText = 'Yes, do it!') {
                Swal.fire({
                    title: title,
                    text: text,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#111827',
                    cancelButtonColor: '#d33',
                    confirmButtonText: confirmBtnText,
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        if (typeof ZaderToast !== 'undefined')
                            ZaderToast.loading('Processing...');
                        const form = document.getElementById(formId);
                        if (form)
                            form.submit();
                    }
                });
            }
        </script>
    </body>
</html>